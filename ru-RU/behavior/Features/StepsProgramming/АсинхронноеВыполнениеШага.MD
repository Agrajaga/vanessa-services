[Ссылка на исходную фичу <Док-АсинхронноеВыполнениеШага.feature>](https://github.com/silverbulleters/vanessa-behavior/tree/develop/features/StepsProgramming/Док-АсинхронноеВыполнениеШага.feature "Оригинальная фича")

**Видео:**

<a href="http://www.youtube.com/watch?feature=player_embedded&v=2439dFQjdoU " target="_blank"><img src="http://img.youtube.com/vi/2439dFQjdoU/0.jpg" alt="IMAGE ALT TEXT HERE" width="240" height="180" border="10" /></a>

**Функционал:** Инструкция по асинхронному выполнению шагов

> **Как** Разработчик

> **Я хочу** чтобы я мог выполнять шаги асинхронно

> **Чтобы** я мог использовать асинхронные механизмы платформы при программировании шагов


**Сценарий:** Работа с таймером

	001. Когда я открываю текстовый редактор
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_1_Работа_с_таймером_001.png>

	002. И в текстовом редакторе я выбираю подсветку языка Gherkin
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_2_Работа_с_таймером_002.png>

	003. И я пишу "Функционал: Фича, в которой есть шаг, который длится неопределенное время  "
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_3_Работа_с_таймером_003.png>

	004. И я пишу "Как Разработчик "
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_4_Работа_с_таймером_004.png>

	005. И я пишу "Я хочу чтобы у меня был шаг, который длится неопределенное время "
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_5_Работа_с_таймером_005.png>

	006. И я пишу "Чтобы я мог выполнить тестовый пример "
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_6_Работа_с_таймером_006.png>

	007. И я добавляю пустую строку
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_7_Работа_с_таймером_007.png>

	008. И я пишу "Контекст: "
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_8_Работа_с_таймером_008.png>

	009. И я пишу "	Дано Я запускаю сценарий открытия TestClient или подключаю уже существующий "
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_9_Работа_с_таймером_009.png>

	010. И я пишу 'И я прижимаю активное окно вправо '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_10_Работа_с_таймером_010.png>

	011. И я перехожу к началу строчки
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_11_Работа_с_таймером_011.png>

	012. И я добавляю пустую строку
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_12_Работа_с_таймером_012.png>

	013. И я пишу 'Сценарий: Долгое проведение документа '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_13_Работа_с_таймером_013.png>

	014. И я пишу '	Когда В панели разделов я выбираю "Основная" '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_14_Работа_с_таймером_014.png>

	015. И я пишу '	И     В панели функций я выбираю "Документ1" '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_15_Работа_с_таймером_015.png>

	016. И я пишу 'И     я нажимаю на кнопку "Создать" '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_16_Работа_с_таймером_016.png>

	017. И я пишу 'Тогда открылось окно "Документ1 (создание)" '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_17_Работа_с_таймером_017.png>

	018. И я пишу 'И     я нажимаю на кнопку "Записать" '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_18_Работа_с_таймером_018.png>

	019. И я пишу 'И     я запоминаю значение поля "Номер" как "НомерДокумента" '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_19_Работа_с_таймером_019.png>

	020. И обратите внимание 'Этот шаг сохранит в переменную Контекст значение поля Номер, т.е. в коде можно будет писать: Контекст.НомерДокумента'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_20_Работа_с_таймером_020.png>

	021. И я пишу 'И     я нажимаю на кнопку "Провести и закрыть" '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_21_Работа_с_таймером_021.png>

	022. И я пишу 'И     я ожидаю окончания проведения документа1 '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_22_Работа_с_таймером_022.png>

	023. И обратите внимание 'В этом шаге мы будем использовать таймер, т.к. мы предполагаем, что документ может проводиться достаточно долго. '
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_23_Работа_с_таймером_023.png>

	024. И я сохраняю файл открытый в редакторе как "Support\Instructions\Temp\РаботаСТаймером.feature"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_24_Работа_с_таймером_024.png>

	025. И я закрываю текстовый редактор
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_25_Работа_с_таймером_025.png>

	026. Когда Я запускаю сеанс TestManager в служебной базе
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_26_Работа_с_таймером_026.png>

	027. И Пауза 5
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_27_Работа_с_таймером_027.png>

	028. И я разворачиваю активное окно на полный экран
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_28_Работа_с_таймером_028.png>

	029. Когда Я нажимаю на кнопку диалога выбора файлов
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_29_Работа_с_таймером_029.png>

	030. И в открывшемся окне я указываю путь к обработке Vanessa-behavior.epf
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_30_Работа_с_таймером_030.png>

	031. Когда Я нажимаю на кнопку Загрузить одну фичу
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_31_Работа_с_таймером_031.png>

	032. Тогда в открывшемся окне я указываю путь к фиче   'Support\Instructions\Temp\РаботаСТаймером.feature'  
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_32_Работа_с_таймером_032.png>

	033. Когда я перехожу к закладке Генератор EPF
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_33_Работа_с_таймером_033.png>

	034. И я изменяю флаг Генерировать управляемую форму
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_34_Работа_с_таймером_034.png>

	035. И я изменяю флаг Создавать области при генерации кода
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_35_Работа_с_таймером_035.png>

	036. И я нажимаю на кнопку Создать и обновить шаблоны обработок
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_36_Работа_с_таймером_036.png>

	037. И В каталоге появилась обработка "Support\Instructions\Temp\step_definitions\РаботаСТаймером.epf"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_37_Работа_с_таймером_037.png>

	038. Тогда я запускаю конфигуратор служебной базы
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_38_Работа_с_таймером_038.png>

	039. Когда я в диалоге открытия файлов конфигуратора указываю   'Support\Instructions\Temp\step_definitions\РаботаСТаймером.epf'  
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_39_Работа_с_таймером_039.png>

	040. И я открываю основную форму обработки
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_40_Работа_с_таймером_040.png>

	041. И я перехожу на закладку Модуль
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_41_Работа_с_таймером_041.png>

	042. И я сворачиваю область Служебные функции
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_42_Работа_с_таймером_042.png>

	043. И я заменяю строку   "ВызватьИсключение"   на   "//ВызватьИсключение"  
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_43_Работа_с_таймером_043.png>

	044. И обратите внимание 'Обратите внимание. В модуле была создана только одна процедура, хотя шагов в фиче было больше.'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_44_Работа_с_таймером_044.png>

	045. И обратите внимание 'Это происходит благодаря механизму повторного использования шагов.'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_45_Работа_с_таймером_045.png>

	046. И я перехожу внутрь процедуры "ЯОжидаюОкончанияПроведенияДокумента1"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_46_Работа_с_таймером_046.png>

	047. И я добавляю строку 'Ванесса.ЗапретитьВыполнениеШагов();'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_47_Работа_с_таймером_047.png>

	048. И я добавляю строку 'ПодключитьОбработчикОжидания("ОбработчикОжиданияПроведенияДокумента",1);'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_48_Работа_с_таймером_048.png>

	049. И обратите внимание 'Теперь мы остановили выполнение шагов, пока не выполнится нужное нам условие.'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_49_Работа_с_таймером_049.png>

	050. И я перехожу в конец модуля
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_50_Работа_с_таймером_050.png>

	051. И я добавляю строку '&НаКлиенте'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_51_Работа_с_таймером_051.png>

	052. И я добавляю строку 'Процедура ОбработчикОжиданияПроведенияДокумента()'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_52_Работа_с_таймером_052.png>

	053. И я добавляю строку 'Если ДокументСуществует(Контекст.НомерДокумента,Истина) Тогда'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_53_Работа_с_таймером_053.png>

	054. И я добавляю строку 'ОтключитьОбработчикОжидания("ОбработчикОжиданияПроведенияДокумента");'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_54_Работа_с_таймером_054.png>

	055. И я добавляю строку 'Ванесса.ПродолжитьВыполнениеШагов();'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_55_Работа_с_таймером_055.png>

	056. И я добавляю строку 'КонецЕсли;'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_56_Работа_с_таймером_056.png>

	057. И я добавляю строку 'КонецПроцедуры'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_57_Работа_с_таймером_057.png>

	058. И я перехожу в конец модуля
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_58_Работа_с_таймером_058.png>

	059. И я добавляю строку '&НаСервере'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_59_Работа_с_таймером_059.png>

	060. И я добавляю строку 'Функция ДокументСуществует(Номер,Проведен)'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_60_Работа_с_таймером_060.png>

	061. И я вызываю конструктор запроса с обработкой результата
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_61_Работа_с_таймером_061.png>

	062. И я перехожу к закладке Таблицы и поля
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_62_Работа_с_таймером_062.png>

	063. И я перехожу к ветке дерева "Документы"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_63_Работа_с_таймером_063.png>

	064. И я перехожу к ветке дерева "Документ1"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_64_Работа_с_таймером_064.png>

	065. И я перехожу к строке дерева "Ссылка"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_65_Работа_с_таймером_065.png>

	066. И я выбираю текущую строку
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_66_Работа_с_таймером_066.png>

	067. И я перехожу к закладке Условия
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_67_Работа_с_таймером_067.png>

	068. И я перехожу к левой части условий запроса
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_68_Работа_с_таймером_068.png>

	069. И я раскрываю ветку дерева
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_69_Работа_с_таймером_069.png>

	070. И я перехожу к строке дерева "Номер"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_70_Работа_с_таймером_070.png>

	071. И я выбираю текущую строку
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_71_Работа_с_таймером_071.png>

	072. И я перехожу к строке дерева "Проведен"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_72_Работа_с_таймером_072.png>

	073. И я выбираю текущую строку
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_73_Работа_с_таймером_073.png>

	074. И я нажимаю кнопку ОК конструктора запросов
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_74_Работа_с_таймером_074.png>

	075. И я добавляю строку после текста "ВыборкаДетальныеЗаписи.Следующий()"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_75_Работа_с_таймером_075.png>

	076. И я добавляю строку 'Возврат Истина;'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_76_Работа_с_таймером_076.png>

	077. И я добавляю строку после текста "КонецЦикла;"
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_77_Работа_с_таймером_077.png>

	078. И я добавляю строку 'Возврат Ложь;'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_78_Работа_с_таймером_078.png>

	079. И я добавляю строку 'КонецФункции'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_79_Работа_с_таймером_079.png>

	080. И я сохраняю изменения в файле
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_80_Работа_с_таймером_080.png>

	081. И я закрываю конфигуратор служебной базы
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_81_Работа_с_таймером_081.png>

	082. И я прижимаю активное окно влево
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_82_Работа_с_таймером_082.png>

	083. И Я нажимаю на кнопку Перезагрузить сценарии
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_83_Работа_с_таймером_083.png>

	084. И Я нажимаю на кнопку Выполнить Сценарии
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_84_Работа_с_таймером_084.png>

	085. И я ожидаю окончания выполнения сценариев в сеансе служебной базы
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_85_Работа_с_таймером_085.png>

	086. И обратите внимание 'Спасибо за внимание!'
<img src=Pict/АсинхронноеВыполнениеШага/АсинхронноеВыполнениеШага_86_Работа_с_таймером_086.png>
